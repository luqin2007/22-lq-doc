LangChain 支持回调处理器 `CallbackHandler`，可用于在不同阶段进行自定义操作

回调处理器实现 `CallbackHandler` 接口，可集成自 `BaseCallbackHandler`，重写对应方法即可
- 常用的有 `on_llm_start`，`on_chat` 和 `on_llm_error` 等
- 异步回调处理器可继承自 `AsyncCallbackHandler`
- 内置回调处理器有 `FileCallbackHandler`，`StdOutCallbackHandler` 等

![[../../../_resources/images/Pasted image 20241117145953.png]]

LangChain 各个组件都可以注册回调处理器，通过构造函数或其他调用函数中传入 `callbacks` 参数即可。构造函数中注册的回调处理器可用于组件所有方法。
# get_openai_callback

一个上下文管理器，常用于管理文件或网络资源，配合 `with` 使用。

```python
from langchain_community.callbacks.manager import get_openai_callback

with get_openai_callback() as cb:
    # 执行聊天对话

print("\n总计使用的tokens:", cb.total_tokens)
```
