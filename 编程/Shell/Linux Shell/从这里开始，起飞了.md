# 书写格式

脚本第一行使用 `shebang` 符号 `#!` 指定脚本解释器，后面的代码将用指定的解释器运行

```bash
#!/bin/bash
```

使用 `#` 和 `<<` 开头表示单行和多行注释
- 单行注释：直接在 `#` 后使用
- 多行注释：单独一行 `<<标记` 开始，单独一行 `标记` 结束，中间的都是注释，收尾标记相同

```bash
# 单行注释
<<COMMENT
多行注释
注释行1
注释行2
...
注释行N
COMMENT
```
# 执行方式

脚本文件没有 x 权限时，使用解释器运行即可

```bash
$> bash example.sh
```

脚本文件有执行权限时，可以直接运行

```bash
$> chmod +x ./example.sh
$> ./example.sh
```

使用 `pstree` 可以看到，以上两种方法终端都会创建一个新的子线程执行脚本。使用 `source` 或 `.` 在当前终端线程执行脚本

```bash
$> source example.sh
$> . example.sh
```
# 输入输出

## 输出

### echo

使用 `echo` 输出后面的字符串，`-e` 可以识别转义字符

![[../../../_resources/images/Pasted image 20241116013008.png]]

转义字符中，`\e` 或 `\033` 可以设置终端属性，如字体颜色、背景、光标等
- 以 `[` 开始，以 `m` 结束，以 `;` 分隔
- 后接 1 或 2 个数字，第一个数字表示样式，第二个表示颜色

`````col
````col-md
flexGrow=1
===

| 第一位参数 | 格式         |
| ----- | ---------- |
| `0`   | 无格式，后面不接数字 |
| `1`   | 加粗，后面不接数字  |
| `3`   | 前景色        |
| `4`   | 背景色        |

````
````col-md
flexGrow=1
===

| 第二位参数 | 颜色  |
| ----- | --- |
| `0`   | 黑色  |
| `1`   | 红色  |
| `2`   | 绿色  |
| `3`   | 黄色  |
| `4`   | 蓝色  |
| `5`   | 紫色  |
| `6`   | 浅蓝色 |
| `7`   | 灰色  |

````
`````
### printf

类似 C/C++ 的 `printf` 函数，通过占位符输出，本身支持转义符，支持 `\e` 设置文本格式

![[../../../_resources/images/Pasted image 20241116022026.png]]
## 输入

### read

从控制台中读取输入并存入变量中，有几个变量读几组输入

```bash
read <options> <variables>
```


`````col
````col-md
flexGrow=1
===

| 参数   | 说明                              |
| ---- | ------------------------------- |
| `-p` | 显示提示信息                          |
| `-t` | 设置输入超时                          |
| `-n` | 读入 n 个字符，而不是一整行                 |
| `-r` | 读入原字符，即不将 `\` 理解为转义字符，而是 `\` 本身 |
| `-s` | 静默模式，不显示输入的内容，可用于密码等场景      |

````
````col-md
flexGrow=1
===
![[../../../_resources/images/Pasted image 20241116022843.png]]
````
`````
## 管道

管道用于组合多条命令，让上一条命令的输出作为下一条命令的输入

![[../../../_resources/images/Pasted image 20241120102021.png]]

`who` 用于检查有哪些账户在什么时候登录系统，`wc` 用于统计文本行数。通过 `|` 将 `who` 的结果传递给 `wc` 自动统计登录条数

常用的工具有：
- `wc`：统计行数、词数、字节数、字符数等
- `grep <content>`：过滤，只保留包含 `<content>` 的行
# 重定向

使用 `>` 或 `>>` 重定向输出流，`<` 重定向输入流，常用于导入导出文本内容
- `>` 会覆盖输出文件，`>>` 则会追加内容
- `<` 用于输入一个文件内容，`<<` 则用于输入一段话。开头结尾使用 `<TAG>` 匹配
	- `<<-` 可忽略每行前的 <kbd>Tab</kbd>

```bash
<< <TAG>
...
<TAG>
```

标准输入流即控制台记为 `0`，标准输出流为 `1`，标准错误输出为 `2`

![[../../../_resources/images/Pasted image 20241120103613.png]]

- 对 `0` 和 `1` 的重定向可省略

> [!example] `echo 1>test.txt` 与 `echo >test.txt` 等价

- 使用 `&>` 和 `&>>` 可以同时将标准输出流和标准错误流重定向

> [!example] `ls -l /etc/hosts /nofile &>test.txt`

- 使用 `&0`、` &1 `、` &2 ` 引用标准流（在重定向标记右侧使用）

> [!example] 将错误流重定向到输出流：`2>&1`

- 特殊设备 `/dev/null`，重定向于此可用于销毁所有输出
# 引号

- `""`：内部值为一个整体而不是多个参数

> [!example]
> 删除 `a`，`b`，`c` 三个文件
> ```bash
> rm -rf a b c
> ```
> 
> 删除名为 `a b c` 的文件
> ```bash
> rm -rf "a b c"
> ```

- `''`：等同于 `""`，但可以将特殊符号作为普通符号使用，如 `#`，`$`，`*`，`&`，`~`，`()` 等

- \`\`：执行内部的指令，并将输出作为结果替代

> [!example] 打包备份 log 文件到 `log-日期.tar.gz`
> ```bash
> tar -czf ~/log-`date +%Y%m%d`.tar.gz  /var/log/
> ```
# 变量

变量合法命名包括字母、数字、下划线，且不以下划线开头
- 使用 `<name>=<value>` 创建变量，注意 `=` 两边不能有空格
- 使用 `$<name>` 或 `${<name>}` 引用变量
- 使用 `unset <name>` 删除变量

> [!example] 变量使用
> 创建变量 test=123
> ```bash
> test=123
> ```
> 使用变量
> ```bash
> # 123
> echo $test
> ```
> 若变量后面直接连接字符串，为避免歧义可使用 ${}
> ```bash
> # 123RMB
> echo ${test}RMB
> ```
> 但如果有 ` `，`-`，`:` 等分隔不需要
> ```bash
> # 123 RMB
> echo $test RMB
> # 123-RMB
> echo $test-RMB
> ```
> 变量可以在 `""` 中使用，但不能在 `''` 中使用
> ```bash
> # 123 RMB
> echo "$test RMB"
> # $test RMB
> echo '$test RMB'
> ```
> 删除变量
> ```bash
> unset test
> ```

`$` 还可以引用系统预设变量

| 变量名        | 描述                                         |
| ---------- | ------------------------------------------ |
| `UID`      | 当前账户的账户ID号                                 |
| `USER`     | 当前账户的账户名称                                  |
| `HISTSIZE` | 当前终端的最大历史命令条目数量(最多可以记录多少条历史命令)             |
| `HOME`     | 当前账户的根目录                                   |
| `LANG`     | 当前环境使用的语言                                  |
| `PATH`     | 命令搜索路径                                     |
| `PWD`      | 返回当前工作目录                                   |
| `RANDOM`   | 随机返回0至32767的整数                             |
| `$0`       | 返回当前命令的名称                                  |
| `$n`       | 返回位置参数,如 `$1` 为(第一个位置参数)，数字大于 9 时必须使用 ${n} |
| `$#`       | 命令参数的个数                                    |
| `$*`       | 命令行的所有参数，`$*` 所有的参数作为一个整体                  |
| `$@`       | 命令行的所有参数，`$@` 所有的参数作为独立的个体                 |
| `$?`       | 返回上一条命令退出时的状态代码，通常 0 代表正确                  |
| `$$`       | 返回当前进程的进程号                                 |
| `$!`       | 返回最后一个后台进程的进程号                             |
# 数据过滤与正则

`grep` 进行模式匹配（查找），支持正则和 POSIX 规范字符集；`egrep` 支持扩展正则表达式

> [!note] 扩展正则表达式、
> - 支持 `+`，`?`，`|`
> - `{}` 和 `()` 不需要 `\` 转义

```bash
grep <option> <regex> <content>
```

- `<option>`：参数
	- `-i`：忽略大小写
	- `-v`：取反
	- `-w`：匹配单词
	- `-q`：静默匹配，不将结果显示在屏幕上
- `<regex>`：正则表达式
- `<content>`：文件或搜索内容

> [!note] POSIX 规范字符集
> |字符集|含义|
> | --- | --- |
> |`[:alpha:]`|字母字符|
> |`[:alnum:]`|字母与数字字符|
> | `[:cntrl:]` |控制字符|
> | `[:digit:]` |数字字符|
> | `[:xdigit:]` |十六进制数字字符|
> | `[:punct:]` |标点符号|
> | `[:graph:]` |非空格字符|
> | `[:print:]` |任意可以显示的字符|
> | `[:space:]` |任意可以产生空白的字符|
> | `[:blank:]` |空格与Tab键字符|
> | `[:lower:]` |小写字符|
> | `[:upper:]` |大写字符|
# 算术运算

- 使用 `$((表达式))`，`$[表达式]`，`let 表达式` 进行整数运算
- 使用 `bc` 命令进行浮点数运算，该计算器可进行任何算术运算
	- 将表达式通过管道输入 `bc` 即可
	- 也可以通过 `bc` 命令进入交互环境，使用 `quit` 退出

| 运算符号        | 含义描述            |
| ----------- | --------------- |
| ++          | 自加1             |
| --          | 自减1             |
| +           | 加法              |
| -           | 减法              |
| *           | 乘法              |
| /           | 除法              |
| **          | 求幂              |
| %           | 取余(求模)          |
| +=          | 自加任意数           |
| -=          | 自减任意数           |
| *=          | 自乘任意数           |
| /=          | 自除任意数           |
| %=          | 对任意数取余          |
| &&          | 逻辑与             |
| \|          | 逻辑或             |
| >           | 大于              |
| >=          | 大于或等于           |
| <           | 小于              |
| <=          | 小于或等于           |
| 表达式?表达式:表达式 | 根据表达式的结果,返回特定的值 |
