# 人工智能，很人工，很智能的脚本
# 判断

Bash 单独计算布尔判断可以使用 `[[表达式]]`，`[表达式]` 或 `test 表达式` 等格式，结果不会直接输出，而是通过 `$?` 变量查看

> [!attention] 注意 `[]` 括号与表达式前后均有空格，`==` 两边也都有空格

![[../../../_resources/images/Pasted image 20241120195949.png]]

布尔判断的 `&&`、`||` 运算符支持短路执行

![[../../../_resources/images/Pasted image 20241120200111.png]]

## 整数大小

整数比较判断使用比较运算符（`a op b` 形式）

| 符号 op | 含义                           |
| ----- | ---------------------------- |
| -eq   | 等于(equal)                    |
| -ne   | 不等于(not equal)               |
| -gt   | 大于(greater than)             |
| -ge   | 大于或等于(greater than or equal) |
| -lt   | 小于(less than)                |
| -le   | 小于或等于(less or equal)         |

> [!example] 从 meminfo 获取剩余内存（单位：KB），并判断是否不大于 500MB
> ```bash
> mem_free=$(grep Available /proc/meminfo | egrep -o "[0-9]+")
> [ $mem_free -le 512000 ] && echo Y || echo N
> ```
> ![[../../../_resources/images/Pasted image 20241120201042.png]]


> [!example] 获取当前进程数，判断是否打开了超过 100 个进程
> ```bash
> procs=$(ps aux | wc -l)
> [ $procs -gt 100 ] && echo Y || echo N
> ```
> ![[../../../_resources/images/Pasted image 20241120201315.png]]

## 文件属性

比较文件与目录是否存在、属性，或两个文件的修改时间

| 操作符             | 功能描述                                           |
| --------------- | ---------------------------------------------- |
| ‘-e file        | 判断文件或目录是否存在                                    |
| -f file         | 判断存在且为普通文件                                     |
| -d file         | 判断存在且为目录                                       |
| -b file         | 判断存在且为块设备文件(如磁盘、U盘等设备)                         |
| -c file         | 判断存在且为字符设备文件(如键盘、鼠标等设备)                        |
| -L file         | 判断存在且为软链接文件                                    |
| ’-p file        | 判断存在且为命名管道                                     |
| ‘-r file        | 判断存在且当前用户对该文件具有可读权限                            |
| -w file         | 判断存在且当前用户对该文件具有可写权限                            |
| -x file         | 判断存在且当前用户对该文件具有可执行权限                           |
| -s file         | 判断存在且文件大小非空                                    |
| file1 -ef file2 | 两个文件相同，具有相同 inode 编号                           |
| file1 -nt file2 | file1 比 file2 更新（比较修改时间），或 file1 存在而 file2 不存在 |
| file1 -ot file2 | 等价于 `file2 -nt file1`                          |
```dirtree
- ver1.txt
- ver2.txt
- test
  - ver3.txt
```

- 判断文件是否存在

![[../../../_resources/images/Pasted image 20241120202801.png]]

- 判断是否为文件、目录、设备

![[../../../_resources/images/Pasted image 20241120202825.png]]

# `[[]]`

`[]` 和 `test` 符合 POSIX 规则，而 `[[]]` 