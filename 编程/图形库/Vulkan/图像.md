图像与[[缓冲区]]类似，使用方法也很像。但缓冲区相比，具有格式和布局，因此其中的数据未必是线型的。
1. 创建图像 `VkImage`：使用 `vkCreateImage`
2. 绑定到设备内存：`vkGetImageMemoryRequirements` 获取内存分配信息，使用 `vkBindImageMemory` 绑定内存
# 图像格式

> [!note] 各种格式信息记录在 `vk_format_utils.h` 中
## 非压缩颜色格式

非压缩图像格式名由通道信息和数字格式组成，格式为 `VK_FORMAT_通道信息_数字格式`
- 通道信息：通道名+比特数，如 `R8G8B8`
- 数字格式：每个通道的数据在着色器中是否标准化、CPU 端输入的类型、着色器中读取的类型等，详见表

| 数字格式      | C++输入类型 | 着色器中类型  | 说明（记任意通道占据的比特数为N）                                                                                                                                                         |
| --------- | ------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `UNORM`   | 无符号整型   | `float` | 标准化到 $[0, 1]$ 的范围                                                                                                                                                         |
| `SNORM`   | 无符号整型   | `float` | 标准化到 $[-1, 1]$ 的范围                                                                                                                                                        |
| `USCALED` | 无符号整型   | `float` | 数值不变，转为浮点数，数值范围为 $[0, 2^{N-1}]$                                                                                                                                           |
| `SSCALED` | 有符号整型   | `float` | 数值不变，转为浮点数，数值范围为$[-2^{N-1}, 2^{N-1}-1]$                                                                                                                                   |
| `UINT`    | 无符号整型   | `uint`  | 数值不变，数值范围为$[0, 2^{N-1}]$                                                                                                                                                  |
| `SINT`    | 有符号整型   | `int`   | 数值不变，数值范围为 $[-2^{N-1}, 2^{N-1}-1]$                                                                                                                                        |
| `UFLOAT`  | 无符号浮点数  | `float` | 数值不变                                                                                                                                                                      |
| `SFLOAT`  | 有符号浮点数  | `float` | 数值不变                                                                                                                                                                      |
| `SRGB`    | 无符号整型   | `float` | 标准化到$[ 0, 1]$，通过渲染等方式写入该格式的图像时，对RGB通道应用[sRGB EOTF](https://easyvulkan.github.io/Ch8-5%20sRGB%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%97%B4%E4%B8%8E%E5%BC%80%E5%90%AFHDR.html#srgb) |

> [!example] 
> - `VK_FORMAT_R8G8B8A8_UNORM`：RGBA 通道，每个通道 8 字节，CPU 端提供值为 0-255，着色器中读取值为 0f（对应 0）到 1f（对应 255）
> - `VK_FORMAT_R16G16B16A16_SNORM`：RGBA 通道，每个通道 16 字节，CPU 端提供值为 0-32767，着色器中读取值为 -1f（对应 0） 到 1f（对应 32767）
## 深度模板格式

| 格式名称                            | 说明                                          |
| ------------------------------- | ------------------------------------------- |
| `VK_FORMAT_D16_UNORM`           | 只有深度值，16位无符号整型，被标准化到[ 0, 1]的范围              |
| `VK_FORMAT_X8_D24_UNORM_PACK32` | 共32位，8个比特未使用，只有深度值，24位无符号整型，被标准化到[ 0, 1]的范围 |
| `VK_FORMAT_D32_SFLOAT`          | 只有深度值，32位有符号浮点数                             |
| `VK_FORMAT_S8_UINT`             | 只有模板值，8位无符号整型                               |
| `VK_FORMAT_D16_UNORM_S8_UINT`   | 16位无符号整型作为深度值，被标准化到[ 0, 1]的范围，8位无符号整型作为模板值  |
| `VK_FORMAT_D24_UNORM_S8_UINT`   | 24位无符号整型作为深度值，被标准化到[ 0, 1]的范围，8位无符号整型作为模板值  |
| `VK_FORMAT_D32_SFLOAT_S8_UINT`  | 32位有符号浮点数作为深度值，8位无符号整型作为模板值                 |
> [!note] 可能因内存对齐使用 `VK_FORMAT_D32_SFLOAT_S8_UINT` 存储 8 字节，剩余 24 字节不使用
# ImageView

图像视图 ImageView 定义图像使用方式，使用 `vkCreateImageView` 创建，`VkImageViewCreateInfo` 信息如下：

| 成员                        | 类型                       | 说明                                                   |
| ------------------------- | ------------------------ | ---------------------------------------------------- |
| `sType`                   |                          | 结构体的类型，本处必须是VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO |
| `flags`                   | `VkImageViewCreateFlags` |                                                      |
| `image`                   | `VkImage`                | 图像的handle                                            |
| `viewType`                | `VkImageViewType`        | 图像视图的类型                                              |
| `format`                  | `VkFormat`               | 图像视图的格式，通常与图像的格式一致                                   |
| `VkComponentMapping`      | `components`             | 指定各通道的映射关系                                           |
| `VkImageSubresourceRange` | `subresourceRange`       | 子资源范围                                                |
## 图像类型

`viewType` 指定了图像类型，如 1D，2D，3D 等

| 值                               | 说明      |
| ------------------------------- | ------- |
| VK_IMAGE_VIEW_TYPE_1D           | 1D 图像   |
| `VK_IMAGE_VIEW_TYPE_2D`         | 2D 图像   |
| `VK_IMAGE_VIEW_TYPE_3D`         | 3D 图像   |
| `VK_IMAGE_VIEW_TYPE_CUBE`       | 立方体图像   |
| `VK_IMAGE_VIEW_TYPE_1D_ARRAY`   | 1D 图像数组 |
| `VK_IMAGE_VIEW_TYPE_2D_ARRAY`   | 2D 图像数组 |
| `VK_IMAGE_VIEW_TYPE_CUBE_ARRAY` | 立方体图像数组 |
## 映射关系

`components` 可以设置映射关系，由四个 `VkComponentSwizzle` 组成

| 值                               | 说明            |
| ------------------------------- | ------------- |
| `VK_COMPONENT_SWIZZLE_IDENTITY` | 不改变映射关系       |
| `VK_COMPONENT_SWIZZLE_ZERO`     | 使用该通道的数值一概归 0 |
| `VK_COMPONENT_SWIZZLE_ONE`      | 使用该通道的数值一概归 1 |
| `VK_COMPONENT_SWIZZLE_R`        | 将 R 通道映射到该通道  |
| `VK_COMPONENT_SWIZZLE_G`        | 将 G 通道映射到该通道  |
| `VK_COMPONENT_SWIZZLE_B`        | 将 B 通道映射到该通道  |
| `VK_COMPONENT_SWIZZLE_A`        | 将 A 通道映射到该通道  |
## 访问资源

`subresourceRange` 可用于限制 `ImageView` 对图片的访问范围

> [!note] 图层：类型为某种图像数组时，确定访问的数组索引

| 成员               | 类型                   | 说明            |
| ---------------- | -------------------- | ------------- |
| `aspectMask`     | `VkImageAspectFlags` | 所使用图像的类型（方面？） |
| `baseMipLevel`   | `uint32_t`           | 初始mip等级       |
| `levelCount`     | `uint32_t`           | mip等级总数       |
| `baseArrayLayer` | `uint32_t`           | 初始图层          |
| `layerCount`     | `uint32_t`           | 图层总数          |

当图片中包含多方面信息（如同时包含深度值和模板值），`aspectMask` 可用于限制采样哪方面的图像

| 版本  | 值                              | 说明                           |
| --- | ------------------------------ | ---------------------------- |
| 1.3 | `VK_IMAGE_ASPECT_NONE`         | 不使用任何层面                      |
| 1.0 | `VK_IMAGE_ASPECT_COLOR_BIT`    | 颜色层面                         |
| 1.0 | `VK_IMAGE_ASPECT_DEPTH_BIT`    | 深度层面                         |
| 1.0 | `VK_IMAGE_ASPECT_STENCIL_BIT`  | 模板层面                         |
| 1.0 | `VK_IMAGE_ASPECT_METADATA_BIT` | 元数据层面（稀疏绑定）                  |
| 1.1 | `VK_IMAGE_ASPECT_PLANE_0_BIT`  | 多层面（multi-planar）图像格式的 0 号平面 |
| 1.1 | `VK_IMAGE_ASPECT_PLANE_1_BIT`  | 多层面（multi-planar）图像格式的 1 号平面 |
| 1.1 | `VK_IMAGE_ASPECT_PLANE_2_BIT`  | 多层面（multi-planar）图像格式的 2 号平面 |
